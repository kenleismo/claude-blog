---
import BaseLayout from '../layouts/BaseLayout.astro';

const posts = await Astro.glob('../pages/blog/*.{md,mdx}');

// 按发布日期排序（最新的在前）
const sortedPosts = posts
  .filter(post => post.frontmatter.publishDate)
  .sort((a, b) => new Date(b.frontmatter.publishDate).getTime() - new Date(a.frontmatter.publishDate).getTime());

// 按年份分组
const postsByYear = sortedPosts.reduce((acc, post) => {
  const year = new Date(post.frontmatter.publishDate).getFullYear();
  if (!acc[year]) {
    acc[year] = [];
  }
  acc[year].push(post);
  return acc;
}, {});

const years = Object.keys(postsByYear).sort((a, b) => b - a);
---

<BaseLayout title="Tech Notes - 数据库内核技术博客">
  <div class="mb-12">
    <h1 class="text-3xl font-bold text-gray-900 mb-2">技术博客</h1>
    <p class="text-gray-600">记录数据库内核开发的点点滴滴</p>
  </div>

  {years.map((year) => (
    <section class="mb-12">
      <h2 class="text-2xl font-semibold text-gray-800 mb-6">{year}</h2>
      
      <div class="space-y-6">
        {postsByYear[year].map((post) => {
          const date = new Date(post.frontmatter.publishDate);
          const formattedDate = date.toLocaleDateString('zh-CN', {
            month: '2-digit',
            day: '2-digit'
          });
          
          return (
            <article class="group">
              <div class="flex items-baseline gap-4">
                <time class="text-gray-500 text-sm font-mono w-12 flex-shrink-0">
                  {formattedDate}
                </time>
                <div class="flex-1">
                  <h3>
                    <a 
                      href={post.url}
                      class="text-gray-900 hover:text-blue-600 transition-colors group-hover:text-blue-600"
                    >
                      {post.frontmatter.title}
                    </a>
                  </h3>
                  {post.frontmatter.tags && post.frontmatter.tags.length > 0 && (
                    <div class="flex flex-wrap gap-2 mt-2">
                      {post.frontmatter.tags.map((tag) => (
                        <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded text-xs">
                          #{tag}
                        </span>
                      ))}
                    </div>
                  )}
                </div>
              </div>
            </article>
          );
        })}
      </div>
    </section>
  ))}

  {sortedPosts.length === 0 && (
    <div class="text-center py-12">
      <p class="text-gray-500">暂无博客文章</p>
    </div>
  )}
</BaseLayout>
